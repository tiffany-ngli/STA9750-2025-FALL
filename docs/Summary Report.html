<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eduardo Alarcon, Madison Brinson, Kelly Li, Tiffany Ng, Jonathan Sucuc Socoy">

<title>Summary Report – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-76c7e95723c59cbc01dc74e89f55a0ab.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="././mp01.html"> 
<span class="menu-text">MP#01</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="././mp02.html"> 
<span class="menu-text">MP#02</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="././mp03.html"> 
<span class="menu-text">MP#03</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="././mp04.html"> 
<span class="menu-text">MP#04</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Summary Report</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eduardo Alarcon, Madison Brinson, Kelly Li, Tiffany Ng, Jonathan Sucuc Socoy </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The COVID-19 pandemic was a global shock with lasting impacts that continue to persist in everyday life. Understanding these changes is essential to identifying where aid is needed the most. This research aims to examine whether <strong>COVID-19 reshaped the relationship between neighborhood characteristics and property values across NYC’s 59 Community Districts?</strong></p>
<p>The neighborhood characteristics chosen for analysis reflect aspects of residents’ quality of life. This includes public transportation accessibility, educational attainment, crime rates, job accessibility, and residential density. To examine these changes, the analysis compares pre-COVID (2017-2019) and post-COVID (2021-2023) patterns.</p>
</section>
<section id="relation-to-prior-work" class="level1">
<h1>Relation to Prior Work</h1>
<p>The <a href="https://www.nyc.gov/content/planning/pages/resources/datasets/community-districts">New York City Comptroller’s Office</a> emphasizes that post-COVID recovery has been uneven across neighborhoods. While the city has shown resilience throughout the years, housing shortages and affordability remain major concerns that may have been further challenged by the pandemic. The contribution of our research, in addition to an in-depth analysis of each neighborhood characteristics as an individual unit, is how they interact with one another and, collectively, how well they predict property values, to assess their relation.</p>
</section>
<section id="i.-tranportation-ridership-and-accessibility" class="level1">
<h1>I. Tranportation Ridership and Accessibility</h1>
<section id="did-the-relationship-between-transit-accessibility-ridership-levels-and-property-values-change-from-pre-covid-and-post-covid-across-nycs-cds" class="level4">
<h4 class="anchored" data-anchor-id="did-the-relationship-between-transit-accessibility-ridership-levels-and-property-values-change-from-pre-covid-and-post-covid-across-nycs-cds">Did the relationship between transit accessibility, ridership levels, and property values change from pre-COVID and post-COVID across NYC’s CDs?</h4>
</section>
</section>
<section id="ii.-educational-attainment" class="level1">
<h1>II. Educational Attainment</h1>
<p><a href="https://eduardonyc.github.io/STA9750-2025-FALL/finalproject.html">Did the strength of the relationship between neighborhood education attainment and property values change post-COVID, and did this change differ across NYC’s CDs?</a></p>
<p>Our analysis also examined Educational Attainment (EA) as an essential neighborhood characteristic that may affect property values. Specifically, we wanted to determine if the COVID-19 pandemic influenced property values when comparing pre- and post-pandemic eras through the following research question:</p>
<p>Did the strength of the relationship between neighborhood educational attainment (EA) and property values change post-COVID, and did this change differ across NYC’s CDs?</p>
<p><a href="https://howhousingmatters.org/research-summary/impact-communities-new-geography-jobs">Historically, neighborhood EA has reliably predicted property values, with highly educated workers driving economic demand and raising real estate prices.</a> We expected higher-education CDs to surge during the pandemic recovery (e.g., 2021-2023). Instead, findings reveal a dramatic and statistically significant reversal of this trend.</p>
<p>To isolate the pandemic’s impact on market demand from demographic shifts, we measured each CD’s EA once using 2019 American Community Survey (ACS) data. We held it constant across both periods (pre-COVID: 2017-2019; post-COVID: 2021-2023). As shown in the choropleth map below, EA levels vary drastically across the city’s 59 CDs, ranging from a low of 11.8% “BA+ Attainment,” where BA+ signifies at least a “Bachelor of Arts” degree, in the South Bronx (BX01) to a high of 82.7% in Manhattan’s Midtown area (MN05).</p>
<p><img src="Education01.png" class="img-fluid"></p>
<p>By holding EA constant, we were also able to focus our analysis on determining if neighborhoods with the same 2019 education level experienced different property value growth patterns post-COVID. Initial research showed a correlation between EA and property values in pre- and post-era settings. The overall correlation between these variables declined modestly, from r = 0.77 to r = 0.74. However, this modest 0.03 decline in correlation concealed a profound shift in growth dynamics. When dividing NYC’s 59 CDs into three equal groups by education level (Low, Medium, High terciles), a complete reversal of the traditional “education premium” emerged. Specifically, low-education neighborhoods in the bottom tercile, with a median BA+ EA of 19.2%, saw a 26% increase in median property value. Conversely, high-education neighborhoods in the top tercile, with a median EA of 53.0% BA+, grew by only 11.9%, less than half the rate of their lower-attainment counterparts. The tercile chart below highlights the stark growth differential between these opposing educational neighborhoods.</p>
<p><img src="Education02.png" class="img-fluid"></p>
<p>As shown below, a two-sample t-test confirmed that this 14.2 percentage-point difference in growth rates between education terciles was statistically significant, supporting the conclusion that COVID-19 fundamentally reshaped the relationship between neighborhood characteristics and property values.</p>
<p><img src="Education03.png" class="img-fluid"></p>
<p>To confirm these results weren’t limited to Manhattan, we ran individual borough-level linear regressions. Our analysis found a negative relationship between education and growth across all boroughs, indicating a “growth penalty” across the city. Although the impact varied, all boroughs showed that higher education levels were associated with lower post-COVID growth in property values.</p>
<p><img src="Education04.png" class="img-fluid"></p>
<p><a href="https://www.annualreviews.org/deliver/fulltext/resource/11/1/annurev-resource-100518-094151.pdf?itemId=/content/journals/10.1146/annurev-resource-100518-094151&amp;mimeType=application/pdf">These findings suggest that the pandemic challenged agglomeration effects</a>, as definitions of employment changed with the rise of remote work, reducing the need to live near jobs in high-education NYC CDs. Additionally, general housing affordability motivated buyers to move to lower-cost areas. Outer-borough CDs, such as the South Bronx, which had previously been undervalued, experienced higher rates of property value appreciation. These results further indicate that the traditional “educational premium” associated with higher-education CDs led to post-COVID searches for lower-cost areas. Our research demonstrates how the pandemic reversed the well-established logic between EA and NYC real estate. As a result, we address our overarching question by showing that COVID-19 not only disrupted the real estate market but also reshaped the relationship between neighborhood characteristics and property value.</p>
<p><em>Additional information, including detailed methodology and supplementary diagnostic plots, is available in the comprehensive project report linked below.</em></p>
</section>
<section id="iii.-crime-rates" class="level1">
<h1>III. Crime Rates</h1>
<p><a href="https://kelmli.github.io/STA9750-2025-FALL/final_proj.html">How did crime’s impact on property values (housing costs) change from pre-COVID to post-COVID across NYC’s CDs and did this shift vary by initial crime levels?</a></p>
<p>A key component of the broader question of whether COVID-19 reshaped the relationship between neighborhood characteristics and property values across New York City’s Community Districts is understanding how the role of crime evolved over this period. Crime has long been viewed as a negative neighborhood amenity influencing residential choice and housing demand, but the COVID-19 pandemic disrupted mobility, policing, and neighborhood use in ways that may have altered this relationship. This portion of the analysis focuses on how the impact of serious crime on property values changed from the pre-COVID (2017-2019) to the post-COVID (2021-2023) period, and whether districts with different baseline crime levels experienced these shifts differently.</p>
<p>To address this question, this study integrates Community District-level serious crime rates with housing sales data and compares patterns across the two periods. The analysis uses descriptive comparisons, scatterplots, and grouping districts by pre-COVID crime terciles to assess both how crime changed after COVID and whether changes in crime were associated with shifts in median housing prices. The datasets used are the <a href="https://www.nyc.gov/site/finance/about/open-portal.page">NYC Department of Finance housing sales data</a>, <a href="https://app.coredata.nyc/?mlb=false&amp;mlf=false&amp;ntr=&amp;mz=14&amp;vtl=https%3A%2F%2Fthefurmancenter.carto.com%2Fu%2Fnyufc%2Fapi%2Fv2%2Fviz%2F98d1f16e-95fd-4e52-a2b1-b7abaf634828%2Fviz.json&amp;mln=false&amp;mlp=true&amp;mlat=40.718&amp;nty=&amp;mb=roadmap&amp;pf=%7B%22subsidies%22%3Atrue%7D&amp;md=map&amp;mlng=-73.996&amp;btl=Borough&amp;atp=properties">NYPD crime statistics</a> from the NYU Furman Center, and <a href="https://www.nyc.gov/content/planning/pages/resources/datasets/mappluto-pluto-change">Pluto</a> data to link properties to Community Districts. These methods directly test whether COVID altered the strength or consistency of the crime-price relationship rather than simply changing crime levels alone.</p>
<p>Several visualizations most clearly connect this analysis to the overarching question.</p>
<p>Side-by-side scatterplots of crime rates versus median housing prices before and after COVID show that the average relationship between crime and property values remained relatively flat across periods, suggesting no fundamental citywide shift. <img src="Crime01.png" class="img-fluid"></p>
<p>A bar chart of post-COVID crime changes by pre-COVID crime group demonstrates that increases in serious crime were widespread but largest in already high-crime districts, indicating uneven neighborhood impacts. <img src="Crime02.png" class="img-fluid"></p>
<p>An interactive map displaying simultaneous changes in crime rates and housing prices across Community Districts highlights substantial spatial heterogeneity, reinforcing that COVID-era effects varied sharply by neighborhood. <img src="Crime03.png" class="img-fluid"></p>
<p>Overall, the findings about crime align with prior literature viewing crime as a negative amenity but suggest that COVID made its influence on housing prices more heterogeneous and less predictive on average. Future work could incorporate additional neighborhood characteristics (such as work-from-home exposure, transit access, or demographic change) to better explain how and why COVID reshaped neighborhood-price dynamics across NYC.</p>
</section>
<section id="iv.-job-accessibility" class="level1">
<h1>IV. Job Accessibility</h1>
<p><a href="https://madisonbrinson.github.io/STA9750-2025-FALL/individual_report_final.html">How did the relationship between (job proximity; number of jobs within a neighborhood) and property values shift from the pre-COVID era to the post-CVOID era, given the context of the rise of remote work?</a></p>
<p>A central component of understanding whether COVID-19 reshaped neighborhood-property value relationships is examining how the value of job accessibility changed. Job accessibility, measured as jobs within 1 kilometer of a neighborhood’s centroid, captures the traditional urban economics principle that proximity to employment centers commands a housing premium. The pandemic’s remote work revolution may have weakened this relationship as workers gained location flexibility.</p>
<p>This analysis integrates <a href="https://lehd.ces.census.gov/data/">LODES employment data</a> from the Census Bureau with <a href="https://www.nyc.gov/site/finance/property/property-rolling-sales-data.page">NYC DOF Rolling Sales</a> across all 59 Community Districts, comparing pre-COVID (2017-2019) and post-COVID (2021-2023) periods. Job accessibility was calculated by counting jobs within 1km of each Community District centroid, then correlated with median property values for each period.</p>
<p>The correlation between job accessibility and property values remained remarkably stable, going from r = 0.630 pre-COVID to r = 0.618 post-COVID. Fisher’s Z-test produced a p-value of 0.92, well above 0.05, meaning this small change was not statistically significant. The overall premium for job-accessible locations persisted despite the rise of remote work.</p>
<p>Three visualizations illustrate these findings.</p>
<p><img src="Job01.png" class="img-fluid"></p>
<p>Low job accessibility neighborhoods experienced the highest average property value growth post-COVID, outperforming medium and high accessibility areas. This supports the idea that remote work gave buyers more flexibility to choose neighborhoods farther from job centers.</p>
<p><img src="Job02.png" class="img-fluid"></p>
<p>The bivariate map categorizes each Community District by whether jobs and property values increased or decreased post-COVID. The outer boroughs are predominantly green (‘Jobs Up / Price Up’), while Manhattan shows a mix of patterns, including districts where jobs declined but prices still rose.</p>
<p><img src="Job03.png" class="img-fluid"></p>
<p>The scatter plot shows a weak positive correlation (r = 0.18) between job accessibility change and property value change across Community Districts. There’s a lot of variation across boroughs. Bronx and Brooklyn districts saw some of the highest property value gains regardless of whether jobs increased or decreased. While the overall job-price correlation remained stable, the pattern of price growth favored lower-accessibility neighborhoods. This suggests that even though job proximity still commands a premium, remote work may have made buyers more willing to consider locations farther from job centers than they would have been before the pandemic.</p>
</section>
<section id="residential-density" class="level1">
<h1>Residential Density</h1>
<section id="did-high-residential-density-become-a-penalty-for-property-values-post-covid-across-nycs-cds-and-did-this-density-penalty-vary-by-baseline-density-level" class="level4">
<h4 class="anchored" data-anchor-id="did-high-residential-density-become-a-penalty-for-property-values-post-covid-across-nycs-cds-and-did-this-density-penalty-vary-by-baseline-density-level">Did high residential density become a penalty for property values post-COVID across NYC’s CDs, and did this “density penalty” vary by baseline density level?</h4>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
</section>
<section id="next-steps" class="level1">
<h1>Next Steps</h1>
<p>To refine our model, the neighborhood characteristics that didn’t pose as strong predictors of property values could be substituted for other factors of examination to improve its accuracy. With additional time and resources, this improved model could be applied to other major U.S. cities to further test its validity. While also allowing for a more comprehensive analysis of where New York City’s post-COVID progress stands.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/tiffany-ngli\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>